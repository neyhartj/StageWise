% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Stage1_serial.R
\name{SerialStage1}
\alias{SerialStage1}
\title{Stage 1 analysis of multi-year trials in perennial crops}
\usage{
SerialStage1(
  filename,
  data,
  traits,
  effects = NULL,
  cor.effects = NULL,
  solver = c("asreml"),
  spline = NULL,
  residual = NULL,
  silent = TRUE,
  pred.terms,
  workspace = c("500mb", "500mb")
)
}
\arguments{
\item{filename}{Name of CSV file. If missing, assumes that \code{data} is passed.}

\item{data}{A \code{data.frame} with the columns described above for \code{filename}. If missing, assumes \code{filename} is passed.}

\item{traits}{trait names (see Details)}

\item{effects}{data frame specifying other effects in the model (see Details)}

\item{cor.effects}{data frame specifying serially correlated effects in the model (see Details)}

\item{solver}{one of the following: "asreml","spats"}

\item{spline}{vector of variable names for 2D spline with SpATS}

\item{residual}{Optional custom residual formula (for asreml only)}

\item{silent}{TRUE/FALSE, whether to suppress REML output}

\item{workspace}{memory limits for ASRreml-R}
}
\value{
List containing
\describe{
\item{blues}{data frame of BLUEs}
\item{vcov}{list of variance-covariance matrices for the BLUEs, one per experiment (env)}
\item{fit}{data frame with broad-sense H2 (plot basis) and/or AIC}
\item{resid}{For single trait, list of diagnostic plots and data frame of residuals. For multi-trait, list of resid var-cov matrices.}
}
}
\description{
Computes genotype BLUEs for each experiment
}
\details{
The input file must have one column labeled "id" for the individuals, one labeled "trl" for each trial, and one labeled "har" for the harvest year or other repeated factor. The data for each trial are analyzed independently with a linear mixed model. Although not used in Stage1, to include a genotype x location effect in \code{\link{Stage2}}, a column labeled "loc" should be present in the input file.

Argument \code{effects} is used to specify other i.i.d. effects besides genotype and has three columns: name, fixed, factor. The "name" column is a string that must match a column in the input file. The fixed column is a logical variable to indicate whether the effect is fixed (TRUE) or random (FALSE). The factor column is a logical variable to indicate whether the effect is a factor (TRUE) or numeric (FALSE).

Argument \code{solver} specifies which software to use for REML. Current options are "asreml" and "spats". For "spats", the argument \code{spline} must be a vector of length two, with the names of the x and y variables (respectively) for the 2D spline.

The heritability and residuals in the output are based on a random effects model for id.

Missing response values are omitted for single-trait analysis but retained for multi-trait analysis (unless both traits are missing), to allow for prediction in Stage 2.

Argument \code{workspace} is a vector of length two containing the workspace and pworkspace limits for ASReml-R, with default values of 500mb. If you get an error about insufficient memory, try increasing the appropriate value (workspace for variance estimation and pworkspace for BLUE computation).

For multiple traits, only "asreml" is supported, and only the BLUE model is run, so the returned object does not contain H2.

If the input file has a column "expt", this indicates multiple experiments within environment, which may be needed when using spatial analyses. Each experiment is first analyzed separately, and then the BLUEs from all experiments in one env are jointly analyzed to compute a single BLUE per env. The estimation errors from each experiment are propagated into the multi-expt model.
}
